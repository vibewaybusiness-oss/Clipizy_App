{
  "id": "music-generation-new",
  "name": "Music Generation (New Brick System)",
  "description": "Generates music using the new generic brick system",
  "initialStep": "get_user_description",
  "steps": {
    "get_user_description": {
      "id": "get_user_description",
      "stepNumber": 1,
      "bricks": [],
      "nextStep": "generate_prompt",
      "assistantMessage": {
        "content": "Describe the music you want to generate. For example: 'A hardstyle track at 150 BPM with distorted kick drums and aggressive synthesizer leads.'",
        "showDelay": 1000,
        "enableFileInput": false,
        "enablePromptInput": true
      }
    },

    "generate_prompt": {
      "id": "generate_prompt",
      "stepNumber": 2,
      "bricks": [
        {
          "type": "api_call",
          "id": "gen-prompt-backend",
          "endpoint": "/api/ai/generate-music-prompt",
          "method": "POST",
          "payload": {
            "description": "{{workflowData.userInput}}"
          },
          "waitForResponse": true,
          "timeout": 60000,
          "saveResponse": {
            "key": "generatedPrompt",
            "path": "generated_prompt"
          },
          "onSuccess": {
            "nextStep": "confirm_prompt"
          },
          "onError": {
            "message": "Failed to generate music prompt",
            "retryable": true
          }
        },
        {
          "type": "waiting_display",
          "id": "wait-prompt",
          "listenTo": "gen-prompt-backend",
          "loadingMessage": "Generating your music prompt...",
          "estimatedTime": 10,
          "showProgress": true,
          "onResponse": {
            "success": {
              "message": "Prompt generated successfully!",
              "nextStep": "confirm_prompt"
            },
            "error": {
              "message": "Failed to generate prompt. Please try again.",
              "retryable": true
            }
          }
        }
      ],
      "nextStep": "confirm_prompt"
    },

    "confirm_prompt": {
      "id": "confirm_prompt",
      "stepNumber": 3,
      "bricks": [
        {
          "type": "json_display",
          "id": "display-prompt",
          "dataSource": "workflowData",
          "display": {
            "userFields": [
              { "key": "userInput", "label": "Your Description" }
            ],
            "assistantFields": [
              { "key": "generatedPrompt", "label": "Generated Music Prompt", "editable": true, "format": "textarea" }
            ]
          },
          "actions": [
            {
              "label": "Edit Prompt",
              "action": "edit",
              "variant": "outline",
              "enableEdit": true
            },
            {
              "label": "Generate Music",
              "action": "confirm",
              "variant": "default",
              "saveEdits": true,
              "nextStep": "generate_music"
            }
          ]
        }
      ],
      "nextStep": "generate_music"
    },

    "generate_music": {
      "id": "generate_music",
      "stepNumber": 4,
      "bricks": [
        {
          "type": "api_call",
          "id": "gen-music-backend",
          "endpoint": "/api/ai/generate-music",
          "method": "POST",
          "payload": {
            "prompt": "{{workflowData.generatedPrompt}}",
            "project_id": "{{workflowData.project_id}}"
          },
          "waitForResponse": true,
          "timeout": 300000,
          "saveResponse": {
            "key": "audioUrl",
            "path": "audio_url"
          },
          "onSuccess": {
            "nextStep": "display_music"
          },
          "onError": {
            "message": "Failed to generate music",
            "retryable": true
          }
        },
        {
          "type": "waiting_display",
          "id": "wait-music",
          "listenTo": "gen-music-backend",
          "loadingMessage": "Generating your music track... This may take up to 2 minutes.",
          "estimatedTime": 90,
          "showProgress": true,
          "onResponse": {
            "success": {
              "message": "Music generated successfully!",
              "nextStep": "display_music"
            },
            "error": {
              "message": "Failed to generate music. Please try again.",
              "retryable": true
            }
          }
        }
      ],
      "nextStep": "display_music"
    },

    "display_music": {
      "id": "display_music",
      "stepNumber": 5,
      "bricks": [
        {
          "type": "media_display",
          "id": "music-player",
          "mediaType": "audio",
          "dataSource": "workflowData.audioUrl",
          "controls": {
            "play": true,
            "seek": true,
            "volume": true,
            "download": false
          },
          "metadata": {
            "title": "Your Generated Music",
            "description": "{{workflowData.generatedPrompt}}"
          },
          "actions": [
            {
              "label": "Confirm & Continue",
              "variant": "default",
              "nextStep": "complete"
            },
            {
              "label": "Regenerate",
              "icon": "refresh",
              "variant": "outline",
              "triggerBrick": "gen-music-backend"
            }
          ]
        }
      ],
      "nextStep": "complete"
    },

    "complete": {
      "id": "complete",
      "stepNumber": 6,
      "bricks": [
        {
          "type": "confirmation",
          "id": "final-confirmation",
          "message": "Music generation complete! Your track is ready.",
          "actions": [
            {
              "label": "Create Video",
              "variant": "default",
              "nextStep": "video_generation"
            },
            {
              "label": "Done",
              "variant": "outline",
              "nextStep": "end"
            }
          ]
        }
      ],
      "nextStep": "end"
    }
  }
}

